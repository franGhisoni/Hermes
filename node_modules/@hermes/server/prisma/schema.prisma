generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [vector]
}

model Source {
  id              String   @id @default(uuid())
  name            String
  url             String
  active          Boolean  @default(true)
  scraperConfig   Json     // Stores selectors, wait times, etc.
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  articles        Article[]
  routeRules      RouteRule[]
}

model Article {
  id              String   @id @default(uuid())
  sourceId        String
  source          Source   @relation(fields: [sourceId], references: [id])
  
  originalTitle   String
  originalContent String
  originalUrl     String   @unique
  originalImageUrl String?
  publishedAt     DateTime // When it was published on the source
  
  // Intelligence
  embedding       Unsupported("vector(1536)")?
  interestScore   Int?     // 1-10
  analysisData    Json?    // Stores raw AI analysis stats
  
  // Rewrite
  rewrittenTitle   String?
  rewrittenContent String?
  
  status          ArticleStatus @default(PENDING)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

enum ArticleStatus {
  PENDING
  APPROVED
  REJECTED
  PUBLISHED
}

model PromptConfig {
  id          String      @id @default(uuid())
  name        String
  template    String      // The prompt text with {{placeholders}}
  type        PromptType
  
  routeRules  RouteRule[]
}

enum PromptType {
  REWRITE
  INTEREST
  STYLE
}

model PublicationTarget {
  id          String   @id @default(uuid())
  name        String
  type        TargetType
  config      Json     // { email: "blog@wordpress.com", etc }
  active      Boolean  @default(true)
  
  routeRules  RouteRule[]
}

enum TargetType {
  WORDPRESS_EMAIL
  TWITTER
  CUSTOM_WEBHOOK
}

// Logic: If Source A, Use Prompt B, Send to Target C
model RouteRule {
  id          String   @id @default(uuid())
  
  sourceId    String
  source      Source   @relation(fields: [sourceId], references: [id])
  
  promptId    String
  prompt      PromptConfig @relation(fields: [promptId], references: [id])
  
  targetId    String
  target      PublicationTarget @relation(fields: [targetId], references: [id])
  
  active      Boolean @default(true)
}
